# Individual Causal Analysis Data Dictionary

This document provides comprehensive explanations for all fields in the `df_individuals` DataFrame generated by the individual causal analysis notebook.

## üìã **Overview**
The DataFrame contains individual-level predictions, counterfactuals, treatment effects, and policy recommendations from both Standard and TTT (Test-Time Training) Neural CDE models.

**Total Columns**: ~35+ fields  
**Sample Size**: 60 test individuals  
**Treatments**: 3 treatments (T0=control, T1=beneficial, T2=harmful)

---

## üÜî **Basic Identifiers**

### `individual_id`
- **Type**: Integer (0-59)
- **Description**: Unique identifier for each individual in the test set
- **Usage**: For tracking specific individuals across analyses

### `observed_treatment` 
- **Type**: Integer (0, 1, or 2)
- **Description**: The treatment actually assigned/received by the individual
- **Values**: 
  - 0 = T0 (Control treatment)
  - 1 = T1 (Beneficial treatment, +1.0 effect)
  - 2 = T2 (Harmful treatment, -0.5 effect)
- **Note**: This is what actually happened in the observed data

### `observed_outcome`
- **Type**: Float
- **Description**: The actual outcome value observed for this individual
- **Formula**: `baseline + treatment_effect + noise`
- **Interpretation**: The ground truth outcome we're trying to predict

---

## üéØ **Factual Predictions**

### `std_factual_pred`
- **Type**: Float  
- **Description**: Standard model's prediction for the observed outcome
- **Formula**: Model output for the treatment that was actually assigned
- **Interpretation**: What the standard model thinks would happen given the observed treatment

### `ttt_factual_pred`
- **Type**: Float
- **Description**: TTT model's prediction for the observed outcome (after test-time adaptation)
- **Formula**: TTT-adapted model output for observed treatment
- **Interpretation**: What the TTT model thinks would happen given the observed treatment

### `std_factual_error`
- **Type**: Float (‚â•0)
- **Description**: Absolute error of standard model's factual prediction
- **Formula**: `|std_factual_pred - observed_outcome|`
- **Interpretation**: How far off the standard model was (lower = better)

### `ttt_factual_error`
- **Type**: Float (‚â•0)
- **Description**: Absolute error of TTT model's factual prediction  
- **Formula**: `|ttt_factual_pred - observed_outcome|`
- **Interpretation**: How far off the TTT model was (lower = better)

---

## üîÆ **Counterfactual Predictions**

Counterfactuals answer: "What would have happened if this person received a different treatment?"

### `std_cf_T0`, `std_cf_T1`, `std_cf_T2`
- **Type**: Float
- **Description**: Standard model's predicted outcomes under each treatment
- **Formula**: Model's potential outcome predictions for T0, T1, T2 respectively
- **Interpretation**: What the standard model thinks would happen under each treatment option

### `ttt_cf_T0`, `ttt_cf_T1`, `ttt_cf_T2`  
- **Type**: Float
- **Description**: TTT model's predicted outcomes under each treatment (after adaptation)
- **Formula**: TTT-adapted model's potential outcome predictions
- **Interpretation**: What the TTT model thinks would happen under each treatment option

### `true_cf_T0`, `true_cf_T1`, `true_cf_T2`
- **Type**: Float
- **Description**: True potential outcomes under each treatment (ground truth)
- **Formula**: `baseline + treatment_effect_T[i] + noise` for each treatment
- **Interpretation**: What would actually happen under each treatment (oracle knowledge)

---

## ‚öñÔ∏è **Individual Treatment Effects (ITE)**

ITEs measure the causal effect of treatment relative to control (T0).

### `std_ite_T1`, `std_ite_T2`
- **Type**: Float
- **Description**: Standard model's estimated treatment effects vs control
- **Formula**: `std_cf_T[i] - std_cf_T0` 
- **Interpretation**: How much better/worse T1/T2 is compared to T0 according to standard model
- **Expected**: T1 ‚âà +1.0, T2 ‚âà -0.5

### `ttt_ite_T1`, `ttt_ite_T2`
- **Type**: Float  
- **Description**: TTT model's estimated treatment effects vs control
- **Formula**: `ttt_cf_T[i] - ttt_cf_T0`
- **Interpretation**: How much better/worse T1/T2 is compared to T0 according to TTT model

### `true_ite_T1`, `true_ite_T2`
- **Type**: Float
- **Description**: True treatment effects vs control (ground truth)
- **Formula**: `true_cf_T[i] - true_cf_T0`
- **Interpretation**: The actual causal effect of each treatment
- **True Values**: T1 ‚âà +1.0, T2 ‚âà -0.5

---

## üéØ **Policy Recommendations**

Policy recommendations determine which treatment to assign to maximize outcomes.

### `std_policy_rec`
- **Type**: Integer (0, 1, or 2)
- **Description**: Treatment recommended by standard model
- **Formula**: `argmax(std_cf_T0, std_cf_T1, std_cf_T2)`
- **Interpretation**: Which treatment the standard model thinks is best for this individual

### `ttt_policy_rec`
- **Type**: Integer (0, 1, or 2)  
- **Description**: Treatment recommended by TTT model
- **Formula**: `argmax(ttt_cf_T0, ttt_cf_T1, ttt_cf_T2)`
- **Interpretation**: Which treatment the TTT model thinks is best for this individual

### `true_optimal_policy`
- **Type**: Integer (0, 1, or 2)
- **Description**: Truly optimal treatment (ground truth)
- **Formula**: `argmax(true_cf_T0, true_cf_T1, true_cf_T2)`
- **Interpretation**: Which treatment would actually be best for this individual
- **Expected**: Should be 1 (T1) for all individuals given the treatment effects

### `std_policy_correct`
- **Type**: Boolean (True/False)
- **Description**: Whether standard model's recommendation matches optimal
- **Formula**: `std_policy_rec == true_optimal_policy`
- **Interpretation**: Did the standard model recommend the right treatment?

### `ttt_policy_correct`
- **Type**: Boolean (True/False)
- **Description**: Whether TTT model's recommendation matches optimal  
- **Formula**: `ttt_policy_rec == true_optimal_policy`
- **Interpretation**: Did the TTT model recommend the right treatment?

---

## üìä **Treatment Assignment Probabilities (Propensity Scores)**

These represent learned propensity scores - the probability of receiving each treatment.

### `std_treat_prob_T0`, `std_treat_prob_T1`, `std_treat_prob_T2`
- **Type**: Float (0-1, sum to 1)
- **Description**: Standard model's predicted probability of assignment to each treatment
- **Formula**: `softmax(treatment_classifier_logits)`
- **Interpretation**: How likely the standard model thinks each treatment assignment is
- **Usage**: Can be used for propensity score weighting in causal inference

### `ttt_treat_prob_T0`, `ttt_treat_prob_T1`, `ttt_treat_prob_T2`
- **Type**: Float (0-1, sum to 1)
- **Description**: TTT model's predicted probability of assignment to each treatment
- **Formula**: `softmax(ttt_adapted_treatment_classifier_logits)`
- **Interpretation**: How likely the TTT model thinks each treatment assignment is
- **Usage**: TTT-adapted propensity scores for improved causal inference

---

## üéØ **Confidence and Uncertainty Metrics**

### `std_treat_confidence`
- **Type**: Float (0-1)
- **Description**: Standard model's confidence in treatment assignment
- **Formula**: `max(std_treat_prob_T0, std_treat_prob_T1, std_treat_prob_T2)`
- **Interpretation**: How confident the standard model is about treatment assignment (higher = more confident)

### `ttt_treat_confidence`
- **Type**: Float (0-1)
- **Description**: TTT model's confidence in treatment assignment
- **Formula**: `max(ttt_treat_prob_T0, ttt_treat_prob_T1, ttt_treat_prob_T2)`
- **Interpretation**: How confident the TTT model is about treatment assignment

### `std_observed_treat_prob`
- **Type**: Float (0-1)
- **Description**: Standard model's probability for the actually observed treatment
- **Formula**: `std_treat_prob_T[observed_treatment]`
- **Interpretation**: How well the standard model explains the actual treatment assignment

### `ttt_observed_treat_prob`
- **Type**: Float (0-1)
- **Description**: TTT model's probability for the actually observed treatment
- **Formula**: `ttt_treat_prob_T[observed_treatment]`
- **Interpretation**: How well the TTT model explains the actual treatment assignment

### `std_treat_entropy`
- **Type**: Float (‚â•0)
- **Description**: Uncertainty in standard model's treatment assignment
- **Formula**: `-sum(p * log(p))` where p are treatment probabilities
- **Interpretation**: Higher entropy = more uncertain assignment (lower = more confident)
- **Range**: 0 (completely certain) to log(3)‚âà1.099 (completely uncertain)

### `ttt_treat_entropy`
- **Type**: Float (‚â•0)
- **Description**: Uncertainty in TTT model's treatment assignment
- **Formula**: `-sum(p * log(p))` where p are TTT treatment probabilities  
- **Interpretation**: TTT model's uncertainty in treatment assignment

---

## üìà **Key Relationships and Formulas**

### Treatment Effect Relationships:
```
ITE_T1 = Outcome_T1 - Outcome_T0 ‚âà +1.0
ITE_T2 = Outcome_T2 - Outcome_T0 ‚âà -0.5
```

### Policy Optimality:
```
Optimal_Treatment = argmax(Outcome_T0, Outcome_T1, Outcome_T2)
Policy_Value = max(Outcome_T0, Outcome_T1, Outcome_T2)
```

### Probability Constraints:
```
sum(treat_prob_T0, treat_prob_T1, treat_prob_T2) = 1.0
treat_confidence = max(treat_prob_T0, treat_prob_T1, treat_prob_T2)
```

---

## üîç **Usage Examples**

### Identifying High-Confidence Predictions:
```python
high_confidence = df_individuals[df_individuals['ttt_treat_confidence'] > 0.8]
```

### Finding Individuals Where TTT Improved Policy:
```python
ttt_improvements = df_individuals[
    (df_individuals['ttt_policy_correct'] == True) & 
    (df_individuals['std_policy_correct'] == False)
]
```

### Analyzing Treatment Effect Estimation:
```python
ite_errors = abs(df_individuals['ttt_ite_T1'] - df_individuals['true_ite_T1'])
```

### Propensity Score Analysis:
```python
# Individuals with high probability of observed treatment
well_explained = df_individuals[df_individuals['ttt_observed_treat_prob'] > 0.6]
```

---

## ‚ö†Ô∏è **Important Notes**

1. **Reproducibility**: All results use seed=42 for reproducible generation
2. **Missing T0 ITE**: ITE for T0 vs T0 is always 0, so not included
3. **Expected Patterns**: T1 should have highest outcomes, T2 lowest
4. **Probability Interpretation**: Treatment probabilities are learned propensity scores
5. **TTT Adaptation**: TTT values reflect test-time adapted predictions
6. **Ground Truth**: "True" values represent oracle knowledge for evaluation

---

## üìö **References**

- **TTT**: Test-Time Training for improved predictions
- **ITE**: Individual Treatment Effect (heterogeneous treatment effects)  
- **Propensity Scores**: P(Treatment|Covariates) for confounding adjustment
- **Counterfactuals**: Potential outcomes under different treatments
- **Policy Learning**: Learning optimal treatment assignment rules 